

<blockquote>
<p><strong>この記事は最終更新から1年以上経過しています。</strong> 気をつけてね。</p>
</blockquote>

<p>最近はOpen-source software (OSS) に頼りきりなので、更新があった時に差分をチェックしたい。</p>

<p><a href="http://rubygems.org/gems/grit" rel="nofollow noopener" target="_blank">Grit(RubyGems)</a>で簡単に取れそうなのでやってみた。</p>

<h2>
<span id="対象のossprojectを選ぶ" class="fragment"></span><a href="#%E5%AF%BE%E8%B1%A1%E3%81%AEossproject%E3%82%92%E9%81%B8%E3%81%B6"><i class="fa fa-link"></i></a>対象のOSSProjectを選ぶ</h2>

<p><code>Grit</code>はリモートのリポジトリにを直接見ることが出来なさそうなので、一旦サンプルのOSSProjectをローカルにコピーした。</p>

<p>今回のチョイスは近所のよしみで<strong><code>concrete5</code></strong>です。</p>

<h2>
<span id="タグを取る" class="fragment"></span><a href="#%E3%82%BF%E3%82%B0%E3%82%92%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>タグを取る</h2>

<p><code>./concrete5</code> ディレクトリにクローンしたものとします。<br>
<code>#tag</code>ですべてのタグが<code>Grit::Tag</code>オブジェクトに突っ込まれました。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">rubycode</span></div>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'grit'</span>

<span class="n">repo</span> <span class="o">=</span> <span class="no">Grit</span><span class="o">::</span><span class="no">Repo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'concrete5'</span><span class="p">)</span>
<span class="n">repo</span><span class="p">.</span><span class="nf">tags</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span><span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">t</span><span class="p">.</span><span class="nf">name</span><span class="p">}</span>

<span class="o">=&gt;</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mf">1.2</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mf">1.1</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mi">1</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mf">0.2</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mf">0.1</span>
<span class="mf">5.6</span><span class="o">.</span><span class="mi">0</span>
<span class="mf">5.5</span><span class="o">.</span><span class="mf">2.1</span>
<span class="mf">5.5</span><span class="o">.</span><span class="mi">2</span>
<span class="mf">5.5</span><span class="o">.</span><span class="mi">1</span>
<span class="mf">5.5</span><span class="o">.</span><span class="mi">0</span>
<span class="mf">5.4</span><span class="o">.</span><span class="mf">2.2</span>
<span class="mf">5.4</span><span class="o">.</span><span class="mf">2.1</span>
<span class="mf">5.4</span><span class="o">.</span><span class="mi">2</span>
</pre></div>
</div>

<p><code>5.6.1.2</code>と<code>5.6.1.1</code>の差分が気になる体で行きましょう。</p>

<h2>
<span id="コミット一覧" class="fragment"></span><a href="#%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>コミット一覧</h2>

<p><code>#commits</code>では<code>Grit::Commit</code>オブジェクトがとれました、新しい順ですね。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">rubycode</span></div>
<div class="highlight"><pre><span class="n">repo</span><span class="p">.</span><span class="nf">commits</span><span class="p">(</span><span class="s1">'5.6.1.2'</span><span class="p">)</span>

<span class="o">=&gt;</span> <span class="p">[</span><span class="c1">#&lt;Grit::Commit "b5b03cfdeed7cb512ea75403574599553472102a"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "5b0e2774e8991d236657908208e7be55962697d3"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "7dbc852e3823164374a54fd4a81ce3697ceea6b6"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "9ac5b5413782d191b8c6b120a56761c0c89d93bb"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "a7c323d0c57dec85a26ea2bc7b390c73e0c1adbe"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "8267a2083d3a5b54aedda792a5666ab2a34f05f9"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "c1f7e53cf2d151515d81e11770103a9c3f2b1e41"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "0900e17de378e76adf1a4be5ce7db6ec46681aa7"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "850f05d7acf93cddc97a24877783aaeb2a3a3190"&gt;,</span>
 <span class="c1">#&lt;Grit::Commit "3f1aa9dadf12966c52a083c69e128c7fe97c0b79"&gt;]</span>
</pre></div>
</div>

<p>デフォルトは最新10件です。</p>

<h2>
<span id="diffを取る" class="fragment"></span><a href="#diff%E3%82%92%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>diffを取る</h2>

<p>比較する<code>Grit::Commit</code>のオブジェクトを<code>#diff</code>にかけると、ファイルごとの差分である<code>Grit::Diff</code>オブジェクトが取得できました。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">rubycode</span></div>
<div class="highlight"><pre><span class="n">new_commit</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">commits</span><span class="p">(</span><span class="s1">'5.6.1.2'</span><span class="p">)</span>
<span class="n">old_commit</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">commits</span><span class="p">(</span><span class="s1">'5.6.1.1'</span><span class="p">)</span>

<span class="n">repo</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">new_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">old_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="o">=&gt;</span> <span class="p">[</span><span class="c1">#&lt;Grit::Diff:0x00000002b67248</span>
  <span class="vi">@a_blob</span><span class="o">=</span><span class="c1">#&lt;Grit::Blob "fdf691e"&gt;,</span>
  <span class="vi">@a_mode</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
  <span class="vi">@a_path</span><span class="o">=</span><span class="s2">"web/concrete/blocks/date_nav/auto.js"</span><span class="p">,</span>
  <span class="vi">@b_blob</span><span class="o">=</span><span class="c1">#&lt;Grit::Blob "704f60b"&gt;,</span>
  <span class="vi">@b_mode</span><span class="o">=</span><span class="s2">"100644"</span><span class="p">,</span>
  <span class="vi">@b_path</span><span class="o">=</span><span class="s2">"web/concrete/blocks/date_nav/auto.js"</span><span class="p">,</span>
  <span class="vi">@deleted_file</span><span class="o">=</span><span class="kp">false</span><span class="p">,</span>
  <span class="vi">@diff</span><span class="o">=</span>
   <span class="s2">"--- a/web/concrete/blocks/date_nav/auto.js</span><span class="se">\n</span><span class="s2">+++ b/web/concrete/blocks/date_nav/auto.js</span><span class="se">\n</span><span class="s2">@@ -4,18 +4,18 @@ var dateNav ={</span><span class="se">\n</span><span class="s2"> </span><span class="se">\t\t</span><span class="s2">this.blockForm=document.forms['ccm-block-for
  @new_file=false,
  @renamed_file=false,
  @repo=#&lt;Grit::Repo "</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">higan</span><span class="o">/</span><span class="no">Dev</span><span class="o">/</span><span class="n">git</span><span class="o">-</span><span class="n">check</span><span class="o">/</span><span class="n">concrete5</span><span class="o">/</span><span class="p">.</span><span class="nf">git</span><span class="s2">"&gt;,
  @similarity_index=0&gt;,
</span></pre></div>
</div>

<p><code>@a_path</code>,<code>@b_path</code>,<code>@new_file</code>,<code>@deleted_file</code>,<code>@ renamed_file</code> あたりが気になりますね。</p>

<p>ざっと一覧で見れるように表示します。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">rubycode</span></div>
<div class="highlight"><pre><span class="n">diffs</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">new_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">old_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">diffs</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s1">'a:'</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">a_path</span>
  <span class="nb">puts</span> <span class="s1">'b:'</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">b_path</span>
  <span class="nb">puts</span> <span class="s1">'  New? : '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">new_file</span><span class="p">.</span><span class="nf">to_s</span>
  <span class="nb">puts</span> <span class="s1">'  Deleted? : '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">deleted_file</span><span class="p">.</span><span class="nf">to_s</span>
  <span class="nb">puts</span> <span class="s1">'  Renamed? : '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">renamed_file</span><span class="p">.</span><span class="nf">to_s</span>
<span class="k">end</span>

<span class="o">=&gt;</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">blocks</span><span class="o">/</span><span class="n">date_nav</span><span class="o">/</span><span class="n">auto</span><span class="p">.</span><span class="nf">js</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">blocks</span><span class="o">/</span><span class="n">date_nav</span><span class="o">/</span><span class="n">auto</span><span class="p">.</span><span class="nf">js</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">base</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">base</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">version</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">version</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">single_pages</span><span class="o">/</span><span class="n">dashboard</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">single_pages</span><span class="o">/</span><span class="n">dashboard</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">single_pages</span><span class="o">/</span><span class="n">dashboard</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">types</span><span class="o">/</span><span class="n">add</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">single_pages</span><span class="o">/</span><span class="n">dashboard</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">types</span><span class="o">/</span><span class="n">add</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">text</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">text</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">libraries</span><span class="o">/</span><span class="n">page_cache</span><span class="o">/</span><span class="n">types</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">libraries</span><span class="o">/</span><span class="n">page_cache</span><span class="o">/</span><span class="n">types</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">page_theme</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">page_theme</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">js</span><span class="o">/</span><span class="n">ccm</span><span class="p">.</span><span class="nf">app</span><span class="p">.</span><span class="nf">js</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">js</span><span class="o">/</span><span class="n">ccm</span><span class="p">.</span><span class="nf">app</span><span class="p">.</span><span class="nf">js</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">js</span><span class="o">/</span><span class="n">ccm_app</span><span class="o">/</span><span class="n">legacy_dialog</span><span class="p">.</span><span class="nf">js</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">js</span><span class="o">/</span><span class="n">ccm_app</span><span class="o">/</span><span class="n">legacy_dialog</span><span class="p">.</span><span class="nf">js</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
<span class="n">a</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">url_slug</span><span class="p">.</span><span class="nf">php</span>
<span class="n">b</span><span class="ss">:web</span><span class="o">/</span><span class="n">concrete</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span><span class="n">url_slug</span><span class="p">.</span><span class="nf">php</span>
  <span class="no">New</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Deleted</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
  <span class="no">Renamed</span><span class="p">?</span> <span class="p">:</span> <span class="kp">false</span>
</pre></div>
</div>

<p>ファイル構成には変更が無いみたい。</p>

<h2>
<span id="diff付きで表示する" class="fragment"></span><a href="#diff%E4%BB%98%E3%81%8D%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Diff付きで表示する</h2>

<p>差分情報は<code>Grit::Diff</code>オブジェクトの<code>@diff</code>に入っています。<br>
Syntaxhighlightの関係で全部<code>puts</code>にしたり、出力を一部加工しています。</p>

<p>追記：このサンプル、NewとOldが逆です。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">rubycode</span></div>
<div class="highlight"><pre><span class="n">diffs</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s1">'## '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">a_path</span>
  <span class="nb">puts</span> <span class="s1">'### '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">b_path</span>
  <span class="nb">puts</span> <span class="s1">'**New File!**'</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">new_file</span>
  <span class="nb">puts</span> <span class="s1">'**Deleted!**'</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">deleted_file</span>
  <span class="nb">puts</span> <span class="s1">'**Renamed!!**'</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">renamed_file</span>
  <span class="nb">puts</span> <span class="s2">"### Diff"</span>
  <span class="nb">puts</span> <span class="s1">'```'</span>
  <span class="nb">puts</span> <span class="n">d</span><span class="p">.</span><span class="nf">diff</span> <span class="k">unless</span> <span class="n">d</span><span class="p">.</span><span class="nf">deleted_file</span>
  <span class="nb">puts</span> <span class="s1">'```'</span>
  <span class="nb">puts</span> <span class="s1">'----'</span>
<span class="k">end</span>
<span class="o">----</span>

<span class="o">=&gt;</span>
<span class="c1">## web/concrete/blocks/date_nav/auto.js</span>
<span class="c1">### web/concrete/blocks/date_nav/auto.js</span>

<span class="c1">### Diff</span>
<span class="p">\</span><span class="sb">```
--- a/web/concrete/blocks/date_nav/auto.js
+++ b/web/concrete/blocks/date_nav/auto.js
@@ -4,18 +4,18 @@ var dateNav ={
        this.blockForm=document.forms['ccm-block-form'];

        $('#cParentIDLocation').change(function() {
-           if($('#cParentIDLocation').val() === 'CUSTOM') {
+           if($('#cParentIDLocation').val() == 'CUSTOM') {

            }

        });
-       if (value === "custom") {
-           $("#ccm-autonav-page-selector").css('display','block');
-       } else {
-           $("#ccm-autonav-page-selector").hide();
+       if (value == "custom") {
+               $("#ccm-autonav-page-selector").css('display','block');
+           } else {
+               $("#ccm-autonav-page-selector").hide();
+           }
        }

--snip --

</span></pre></div>
</div>

<h2>
<span id="markdownにする" class="fragment"></span><a href="#markdown%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>MarkDownにする</h2>

<p>引数を取れるようにしてMarkDown形式にして表示するサンプルスクリプトを用意しました。<br>
puts の嵐ですいません。</p>

<p>追記：qiita用にdiffのシンタックスハイライト入れた。<br>
追記：diffがnilだったらコケたので修正<br>
追記：NewとOldが逆だったので直した。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">sample.rb</span></div>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'grit'</span>

<span class="n">repo</span> <span class="o">=</span> <span class="no">Grit</span><span class="o">::</span><span class="no">Repo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">old_commit</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">commits</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">new_commit</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">commits</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">diffs</span> <span class="o">=</span> <span class="n">repo</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="n">old_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_commit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">puts</span> <span class="s2">"# The diff of </span><span class="si">#{</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> between </span><span class="si">#{</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">#{</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">----</span><span class="se">\n</span><span class="s2">"</span>

<span class="n">diffs</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s1">'## '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">a_path</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s1">'### '</span> <span class="o">+</span> <span class="n">d</span><span class="p">.</span><span class="nf">b_path</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s1">'**New File!**  '</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">new_file</span>
  <span class="nb">puts</span> <span class="s1">'**Deleted!**  '</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">deleted_file</span>
  <span class="nb">puts</span> <span class="s1">'**Renamed!!**  '</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">renamed_file</span>
  <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">diff</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">### Diff</span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s1">'```diff:'</span>
    <span class="nb">puts</span> <span class="n">d</span><span class="p">.</span><span class="nf">diff</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2000</span><span class="p">]</span>
    <span class="nb">puts</span> <span class="s1">'```'</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">** Too large, sniped!! **</span><span class="se">\n</span><span class="s2">"</span> <span class="k">if</span> <span class="n">d</span><span class="p">.</span><span class="nf">diff</span><span class="p">.</span><span class="nf">size</span> <span class="o">&gt;</span> <span class="mi">2000</span>
  <span class="k">end</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">----</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>

</pre></div>
</div>

<p>これをTumblrにメールで投稿しようとしたがうまく表示されなかったのでここに貼ってしまおう。</p>

<p>実行はこの様に、ディレクトリとタグなりブランチ(<code>origin/branch_name</code>で渡す)なり、sha1をパスすればOK.</p>

<p><code>$ ruby ./sample.rb concrete5 5.6.1.1 5.6.1.2</code></p>

<p>herokuあたりで適当に自動実行させておきたいですね。</p>

<hr>

<p>以下出力</p>

<h1>
<span id="the-diff-of-concrete5-between-5611-to-5612" class="fragment"></span><a href="#the-diff-of-concrete5-between-5611-to-5612"><i class="fa fa-link"></i></a>The diff of concrete5 between 5.6.1.1 to 5.6.1.2</h1>

<hr>

<h2>
<span id="webconcreteblocksdate_navautojs" class="fragment"></span><a href="#webconcreteblocksdate_navautojs"><i class="fa fa-link"></i></a>web/concrete/blocks/date_nav/auto.js</h2>

<h3>
<span id="webconcreteblocksdate_navautojs-1" class="fragment"></span><a href="#webconcreteblocksdate_navautojs-1"><i class="fa fa-link"></i></a>web/concrete/blocks/date_nav/auto.js</h3>

<h3>
<span id="diff" class="fragment"></span><a href="#diff"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/blocks/date_nav/auto.js
</span><span class="gi">+++ b/web/concrete/blocks/date_nav/auto.js
</span><span class="p">@@ -4,18 +4,18 @@</span> var dateNav ={
        this.blockForm=document.forms['ccm-block-form'];

        $('#cParentIDLocation').change(function() {
<span class="gd">-           if($('#cParentIDLocation').val() == 'CUSTOM') {
</span><span class="gi">+           if($('#cParentIDLocation').val() === 'CUSTOM') {
</span>
            }

        });
<span class="gd">-       if (value == "custom") {
-               $("#ccm-autonav-page-selector").css('display','block');
-           } else {
-               $("#ccm-autonav-page-selector").hide();
-           }
</span><span class="gi">+       if (value === "custom") {
+           $("#ccm-autonav-page-selector").css('display','block');
+       } else {
+           $("#ccm-autonav-page-selector").hide();
</span>        }

+       
        /*
        this.cParentIDRadios=this.blockForm.cParentID;
        for(var i=0;i&lt;this.cParentIDRadios.length;i++){
<span class="p">@@ -41,7 +41,7 @@</span> var dateNav ={
    }, 
    showDescriptionOpts:function(){ 
        for(var i=0;i&lt;this.showDescriptionsRadios.length;i++){
<span class="gd">-           if( this.showDescriptionsRadios[i].checked &amp;&amp; this.showDescriptionsRadios[i].value=='1' ){
</span><span class="gi">+           if( this.showDescriptionsRadios[i].checked &amp;&amp; this.showDescriptionsRadios[i].value==='1' ){
</span>                $('div#ccm-pagelist-summariesOptsWrap').css('display','block'); 
                return; 
            }               
<span class="p">@@ -72,7 +72,7 @@</span> var dateNav ={
    },  
    locationOtherShown:function(){
        for(var i=0;i&lt;this.cParentIDRadios.length;i++){
<span class="gd">-           if( this.cParentIDRadios[i].checked &amp;&amp; this.cParentIDRadios[i].value=='OTHER' ){
</span><span class="gi">+           if( this.cParentIDRadios[i].checked &amp;&amp; this.cParentIDRadios[i].value==='OTHER' ){
</span>                $('div.ccm-page-list-page-other').css('display','block');
                return; 
            }               
<span class="p">@@ -83,7 +83,7 @@</span> var dateNav ={

        var failed=0; 

-       if( failed==1 ){
<span class="gi">+       if( failed===1 ){
</span>            ccm_isBlockError=1;
            return false;
        }
<span class="p">@@ -93,4 +93,4 @@</span> var dateNav ={
 }
 $(function(){ dateNav.init(); });

-ccmValidateBlockForm = function() { return dateNav.validate(); }
<span class="err">\</span> No newline at end of file
<span class="gi">+ccmValidateBlockForm = function() { return dateNav.validate(); }
</span></pre></div></div>

<hr>

<h2>
<span id="webconcreteconfigbasephp" class="fragment"></span><a href="#webconcreteconfigbasephp"><i class="fa fa-link"></i></a>web/concrete/config/base.php</h2>

<h3>
<span id="webconcreteconfigbasephp-1" class="fragment"></span><a href="#webconcreteconfigbasephp-1"><i class="fa fa-link"></i></a>web/concrete/config/base.php</h3>

<h3>
<span id="diff-1" class="fragment"></span><a href="#diff-1"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/config/base.php
</span><span class="gi">+++ b/web/concrete/config/base.php
</span><span class="p">@@ -93,6 +93,11 @@</span> if (!defined("PAGE_PATH_SEPARATOR")) {
    define('PAGE_PATH_SEPARATOR', '-');
 }

+if (!defined('PAGE_PATH_SEGMENT_MAX_LENGTH')) {
<span class="gi">+   define('PAGE_PATH_SEGMENT_MAX_LENGTH', '128');
+}
+
+
</span> if (!defined('ENABLE_ASSET_COMPRESSION')) {
    define('ENABLE_ASSET_COMPRESSION', false);
 }
</pre></div></div>

<hr>

<h2>
<span id="webconcreteconfigversionphp" class="fragment"></span><a href="#webconcreteconfigversionphp"><i class="fa fa-link"></i></a>web/concrete/config/version.php</h2>

<h3>
<span id="webconcreteconfigversionphp-1" class="fragment"></span><a href="#webconcreteconfigversionphp-1"><i class="fa fa-link"></i></a>web/concrete/config/version.php</h3>

<h3>
<span id="diff-2" class="fragment"></span><a href="#diff-2"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/config/version.php
</span><span class="gi">+++ b/web/concrete/config/version.php
</span><span class="p">@@ -1,3 +1,3 @@</span>
 &lt;?
 defined('C5_EXECUTE') or die("Access Denied.");
<span class="gd">-$APP_VERSION = '5.6.1.1';
</span><span class="err">\</span> No newline at end of file
<span class="gi">+$APP_VERSION = '5.6.1.2';
</span><span class="err">\</span> No newline at end of file
</pre></div></div>

<hr>

<h2>
<span id="webconcretecorecontrollerssingle_pagesdashboardpagestypesphp" class="fragment"></span><a href="#webconcretecorecontrollerssingle_pagesdashboardpagestypesphp"><i class="fa fa-link"></i></a>web/concrete/core/controllers/single_pages/dashboard/pages/types.php</h2>

<h3>
<span id="webconcretecorecontrollerssingle_pagesdashboardpagestypesphp-1" class="fragment"></span><a href="#webconcretecorecontrollerssingle_pagesdashboardpagestypesphp-1"><i class="fa fa-link"></i></a>web/concrete/core/controllers/single_pages/dashboard/pages/types.php</h3>

<h3>
<span id="diff-3" class="fragment"></span><a href="#diff-3"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/core/controllers/single_pages/dashboard/pages/types.php
</span><span class="gi">+++ b/web/concrete/core/controllers/single_pages/dashboard/pages/types.php
</span><span class="p">@@ -56,9 +56,9 @@</span> class Concrete5_Controller_Dashboard_Pages_Types extends DashboardBaseController

        if (!$ctName) {
            $this-&gt;error-&gt;add(t("Name required."));
<span class="gd">-       } else if (preg_match('/[^0-9A-Z\.\!\&amp;\(\)\-\_ ]/i', $ctName)) {
-           $this-&gt;error-&gt;add(t('Page type names can only contain letters, numbers, spaces and the following symbols: !, &amp;, (, ), -, _.'));
-       }
</span><span class="gi">+       } else if (preg_match('/[&lt;&gt;;{}?"`]/i', $ctName)) {
+           $this-&gt;error-&gt;add(t('Invalid characters in page type name.'));
+       }
</span>

        if (!$valt-&gt;validate('update_page_type')) {
</pre></div></div>

<hr>

<h2>
<span id="webconcretecorecontrollerssingle_pagesdashboardpagestypesaddphp" class="fragment"></span><a href="#webconcretecorecontrollerssingle_pagesdashboardpagestypesaddphp"><i class="fa fa-link"></i></a>web/concrete/core/controllers/single_pages/dashboard/pages/types/add.php</h2>

<h3>
<span id="webconcretecorecontrollerssingle_pagesdashboardpagestypesaddphp-1" class="fragment"></span><a href="#webconcretecorecontrollerssingle_pagesdashboardpagestypesaddphp-1"><i class="fa fa-link"></i></a>web/concrete/core/controllers/single_pages/dashboard/pages/types/add.php</h3>

<h3>
<span id="diff-4" class="fragment"></span><a href="#diff-4"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/core/controllers/single_pages/dashboard/pages/types/add.php
</span><span class="gi">+++ b/web/concrete/core/controllers/single_pages/dashboard/pages/types/add.php
</span><span class="p">@@ -23,8 +23,8 @@</span> class Concrete5_Controller_Dashboard_Pages_Types_Add extends DashboardBaseContro

        if (!$ctName) {
            $this-&gt;error-&gt;add(t("Name required."));
<span class="gd">-       } else if (preg_match('/[^0-9A-Z\.\!\&amp;\(\)\-\_ ]/i', $ctName)) {
-           $this-&gt;error-&gt;add(t('Page type names can only contain letters, numbers, spaces and the following symbols: !, &amp;, (, ), -, _.'));
</span><span class="gi">+       } else if (preg_match('/[&lt;&gt;{};?"`]/i', $ctName)) {
+           $this-&gt;error-&gt;add(t('Invalid characters in page type name.'));
</span>        }

        $valt = Loader::helper('validation/token');
</pre></div></div>

<hr>

<h2>
<span id="webconcretecorehelperstextphp" class="fragment"></span><a href="#webconcretecorehelperstextphp"><i class="fa fa-link"></i></a>web/concrete/core/helpers/text.php</h2>

<h3>
<span id="webconcretecorehelperstextphp-1" class="fragment"></span><a href="#webconcretecorehelperstextphp-1"><i class="fa fa-link"></i></a>web/concrete/core/helpers/text.php</h3>

<h3>
<span id="diff-5" class="fragment"></span><a href="#diff-5"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/core/helpers/text.php
</span><span class="gi">+++ b/web/concrete/core/helpers/text.php
</span><span class="p">@@ -33,9 +33,9 @@</span> class Concrete5_Helper_Text {
     * @param string $handle
     * @return string $handle
     */
<span class="gd">-   public function urlify($handle) {
</span><span class="gi">+   public function urlify($handle, $maxlength = PAGE_PATH_SEGMENT_MAX_LENGTH) {
</span>        Loader::library('3rdparty/urlify');
<span class="gd">-       $handle = URLify::filter($handle);
</span><span class="gi">+       $handle = URLify::filter($handle, $maxlength);
</span>        return $handle;
    }

</pre></div></div>

<hr>

<h2>
<span id="webconcretecorelibrariespage_cachetypesfilephp" class="fragment"></span><a href="#webconcretecorelibrariespage_cachetypesfilephp"><i class="fa fa-link"></i></a>web/concrete/core/libraries/page_cache/types/file.php</h2>

<h3>
<span id="webconcretecorelibrariespage_cachetypesfilephp-1" class="fragment"></span><a href="#webconcretecorelibrariespage_cachetypesfilephp-1"><i class="fa fa-link"></i></a>web/concrete/core/libraries/page_cache/types/file.php</h3>

<h3>
<span id="diff-6" class="fragment"></span><a href="#diff-6"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/core/libraries/page_cache/types/file.php
</span><span class="gi">+++ b/web/concrete/core/libraries/page_cache/types/file.php
</span><span class="p">@@ -27,7 +27,7 @@</span> class Concrete5_Library_FilePageCache extends PageCache {
                $dir = DIR_FILES_PAGE_CACHE . '/' . $key[0] . '/' . $key[1] . '/' . $key[2];
            }
            if ($dir &amp;&amp; (!is_dir($dir))) {
<span class="gd">-               mkdir($dir, DIRECTORY_PERMISSIONS_MODE, true);
</span><span class="gi">+               @mkdir($dir, DIRECTORY_PERMISSIONS_MODE, true);
</span>            }
            $path = $dir . '/' . $filename;
            return $path;
<span class="p">@@ -37,7 +37,7 @@</span> class Concrete5_Library_FilePageCache extends PageCache {
    public function purgeByRecord(PageCacheRecord $rec) {
        $file = $this-&gt;getCacheFile($rec);
        if ($file &amp;&amp; file_exists($file)) {
<span class="gd">-           unlink($file);
</span><span class="gi">+           @unlink($file);
</span>        }
    }

@@ -49,14 +49,14 @@ class Concrete5_Library_FilePageCache extends PageCache {
    public function purge(Page $c) {
        $file = $this-&gt;getCacheFile($c);
        if ($file &amp;&amp; file_exists($file)) {
<span class="gd">-           unlink($file);
</span><span class="gi">+           @unlink($file);
</span>        }
    }

    public function set(Page $c, $content) {
        if (!is_dir(DIR_FILES_PAGE_CACHE)) {
<span class="gd">-           mkdir(DIR_FILES_PAGE_CACHE);
-           touch(DIR_FILES_PAGE_CACHE . '/index.html');
</span><span class="gi">+           @mkdir(DIR_FILES_PAGE_CACHE);
+           @touch(DIR_FILES_PAGE_CACHE . '/index.html');
</span>        }

        $lifetime = $c-&gt;getCollectionFullPageCachingLifetimeValue();
</pre></div></div>

<hr>

<h2>
<span id="webconcretecoremodelspage_themephp" class="fragment"></span><a href="#webconcretecoremodelspage_themephp"><i class="fa fa-link"></i></a>web/concrete/core/models/page_theme.php</h2>

<h3>
<span id="webconcretecoremodelspage_themephp-1" class="fragment"></span><a href="#webconcretecoremodelspage_themephp-1"><i class="fa fa-link"></i></a>web/concrete/core/models/page_theme.php</h3>

<h3>
<span id="diff-7" class="fragment"></span><a href="#diff-7"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/core/models/page_theme.php
</span><span class="gi">+++ b/web/concrete/core/models/page_theme.php
</span><span class="p">@@ -266,7 +266,7 @@</span> class Concrete5_Model_PageTheme extends Object {

    public function parseStyleSheet($file, $styles = false) {
        $env = Environment::get();
<span class="gd">-       $themeRec = $env-&gt;getRecord(DIRNAME_THEMES . '/' . $this-&gt;getThemeHandle() . '/' . $file, $this-&gt;getPackageHandle());
</span><span class="gi">+       $themeRec = $env-&gt;getUncachedRecord(DIRNAME_THEMES . '/' . $this-&gt;getThemeHandle() . '/' . $file, $this-&gt;getPackageHandle());
</span>        if ($themeRec-&gt;exists()) {
            $fh = Loader::helper('file');
            $contents = $fh-&gt;getContents($themeRec-&gt;file);
</pre></div></div>

<hr>

<h2>
<span id="webconcretejsccmappjs" class="fragment"></span><a href="#webconcretejsccmappjs"><i class="fa fa-link"></i></a>web/concrete/js/ccm.app.js</h2>

<h3>
<span id="webconcretejsccmappjs-1" class="fragment"></span><a href="#webconcretejsccmappjs-1"><i class="fa fa-link"></i></a>web/concrete/js/ccm.app.js</h3>

<h3>
<span id="diff-8" class="fragment"></span><a href="#diff-8"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/js/ccm.app.js
</span><span class="gi">+++ b/web/concrete/js/ccm.app.js
</span><span class="p">@@ -1,5 +1,5 @@</span>
 function ccmLayout(areaNameNumber,cvalID,layout_id,area,locked){this.layout_id=layout_id;this.cvalID=cvalID;this.locked=locked;this.area=area;this.areaNameNumber=areaNameNumber;this.init=function(){var e=this;this.layoutWrapper=$("#ccm-layout-wrapper-"+this.cvalID);this.ccmControls=this.layoutWrapper.find("#ccm-layout-controls-"+this.cvalID);this.ccmControls.get(0).layoutObj=this;this.ccmControls.mouseover(function(){e.dontUpdateTwins=0;e.highlightAreas(1)});this.ccmControls.mouseout(function(){e.moving||e.highlightAreas(0)});this.ccmControls.find(".ccm-layout-menu-button").click(function(t){e.optionsMenu(t)});this.gridSizing()};this.highlightAreas=function(e){var t=this.layoutWrapper.find(".ccm-add-block");e?t.addClass("ccm-layout-area-highlight"):t.removeClass("ccm-layout-area-highlight")};this.optionsMenu=function(e){ccm_hideMenus();e.stopPropagation();ccm_menuActivated=!0;var t=document.getElementById("ccm-layout-options-menu-"+this.cvalID);if(!t){el=document.createElement("DIV");el.id="ccm-layout-options-menu-"+this.cvalID;el.className="ccm-menu ccm-ui";el.style.display="none";document.body.appendChild(el);t=$(el);t.css("position","absolute");var n='&lt;div class="popover"&gt;&lt;div class="arrow"&gt;&lt;/div&gt;&lt;div class="inner"&gt;&lt;div class="content"&gt;';n+="&lt;ul&gt;";n+='&lt;li&gt;&lt;a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-edit-menu" dialog-title="'+ccmi18n.editAreaLayout+'" dialog-modal="false" dialog-width="550" dialog-height="280" dialog-append-buttons="true" id="menuEditLayout'+this.cvalID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&amp;arHandle="+encodeURIComponent(this.area)+"&amp;layoutID="+this.layout_id+"&amp;cvalID="+this.cvalID+'&amp;atask=layout"&gt;'+ccmi18n.editAreaLayout+"&lt;/a&gt;&lt;/li&gt;";n+='&lt;li&gt;&lt;a onclick="ccm_hideMenus()" href="javascript:void(0)" class="ccm-menu-icon ccm-icon-move-up" id="menuAreaLayoutMoveUp'+this.cvalID+'"&gt;'+ccmi18n.moveLayoutUp+"&lt;/a&gt;&lt;/li&gt;";n+='&lt;li&gt;&lt;a onclick=
</pre></div></div>

<p>** Too large, sniped!! **</p>

<hr>

<h2>
<span id="webconcretejsccm_applegacy_dialogjs" class="fragment"></span><a href="#webconcretejsccm_applegacy_dialogjs"><i class="fa fa-link"></i></a>web/concrete/js/ccm_app/legacy_dialog.js</h2>

<h3>
<span id="webconcretejsccm_applegacy_dialogjs-1" class="fragment"></span><a href="#webconcretejsccm_applegacy_dialogjs-1"><i class="fa fa-link"></i></a>web/concrete/js/ccm_app/legacy_dialog.js</h3>

<h3>
<span id="diff-9" class="fragment"></span><a href="#diff-9"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/js/ccm_app/legacy_dialog.js
</span><span class="gi">+++ b/web/concrete/js/ccm_app/legacy_dialog.js
</span><span class="p">@@ -100,8 +100,11 @@</span> jQuery.fn.dialog.open = function(obj) {
        },*/

        'open': function() {
<span class="gd">-           $("body").attr('data-last-overflow', $('body').css('overflow'));
-           $("body").css("overflow", "hidden");
</span><span class="gi">+           var nd = $(".ui-dialog").length;
+           if (nd == 1) {
+               $("body").attr('data-last-overflow', $('body').css('overflow'));
+               $("body").css("overflow", "hidden");
+           }
</span>        },
        'beforeClose': function() {
            var nd = $(".ui-dialog").length;
</pre></div></div>

<hr>

<h2>
<span id="webconcretetoolspagesurl_slugphp" class="fragment"></span><a href="#webconcretetoolspagesurl_slugphp"><i class="fa fa-link"></i></a>web/concrete/tools/pages/url_slug.php</h2>

<h3>
<span id="webconcretetoolspagesurl_slugphp-1" class="fragment"></span><a href="#webconcretetoolspagesurl_slugphp-1"><i class="fa fa-link"></i></a>web/concrete/tools/pages/url_slug.php</h3>

<h3>
<span id="diff-10" class="fragment"></span><a href="#diff-10"><i class="fa fa-link"></i></a>Diff</h3>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gd">--- a/web/concrete/tools/pages/url_slug.php
</span><span class="gi">+++ b/web/concrete/tools/pages/url_slug.php
</span><span class="p">@@ -1,9 +1,8 @@</span>
 &lt;?
 defined('C5_EXECUTE') or die("Access Denied.");
 if (Loader::helper('validation/token')-&gt;validate('get_url_slug', $_REQUEST['token'])) {
<span class="gd">-   Loader::library('3rdparty/urlify');
-   $name = URLify::filter($_REQUEST['name']);
-
</span><span class="gi">+   $text = Loader::helper('text');
+   $name = $text-&gt;urlify($_REQUEST['name']);
</span>    $ret = Events::fire('on_page_urlify', $_REQUEST['name']);
    if ($ret) {
        $name = $ret;
</pre></div></div>

<hr>
