

<blockquote>
<p><strong>この記事は最終更新から1年以上経過しています。</strong> 気をつけてね。</p>
</blockquote>

<p>Rubyを入れてChefやCucumber、serverspecなどを使いたいインフラさん向けに、UbuntuとCentOSでRVMを使ったRubyのインストール方法を紹介。</p>

<p>標準のPKG操作で1.8系を入れたりするのはちょっとね。。。<br>
ちなみにBundlerをきっちり使えるなら<code>rbenv &amp; ruby-build</code>でもいいです。</p>

<h2>
<span id="rvmのインストール" class="fragment"></span><a href="#rvm%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>RVMのインストール</h2>

<p>RVMのインストールはスクリプトが用意されています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>curl -L https://get.rvm.io | bash -s stable
</pre></div></div>

<h3>
<span id="ubuntu" class="fragment"></span><a href="#ubuntu"><i class="fa fa-link"></i></a>Ubuntu</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">rvm.io</span></div>
<div class="highlight"><pre>Installing RVM to /usr/local/rvm/
    Creating group <span class="s1">'rvm'</span>

<span class="c"># RVM:  Shell scripts enabling management of multiple ruby environments.</span>
<span class="c"># RTFM: https://rvm.io/</span>
<span class="c"># HELP: http://webchat.freenode.net/?channels=rvm (#rvm on irc.freenode.net)</span>
<span class="c"># Cheatsheet: http://cheat.errtheblog.com/s/rvm/</span>
<span class="c"># Screencast: http://screencasts.org/episodes/how-to-use-rvm</span>

<span class="c"># In case of any issues read output of 'rvm requirements' and/or 'rvm notes'</span>

Installation of RVM <span class="k">in</span> /usr/local/rvm/ is almost <span class="nb">complete</span>:

  <span class="k">*</span> First you need to add all <span class="nb">users </span>that will be using rvm to <span class="s1">'rvm'</span> group,
    and <span class="nb">logout</span> - login again, anyone using rvm will be operating with <span class="sb">`</span><span class="nb">umask </span><span class="nv">u</span><span class="o">=</span>rwx,g<span class="o">=</span>rwx,o<span class="o">=</span>rx<span class="sb">`</span><span class="nb">.</span>

  <span class="k">*</span> To start using RVM you need to run <span class="sb">`</span><span class="nb">source</span> /etc/profile.d/rvm.sh<span class="sb">`</span>
    <span class="k">in </span>all your open shell windows, <span class="k">in </span>rare cases you need to reopen all shell windows.

<span class="c"># root,</span>
<span class="c">#</span>
<span class="c">#   Thank you for using RVM!</span>
<span class="c">#   I sincerely hope that RVM helps to make your life easier and</span>
<span class="c">#   more enjoyable!!!</span>
<span class="c">#</span>
<span class="c"># ~Wayne</span>
</pre></div>
</div>

<p>RVMがインストールされました。<br>
インストールが完了したので指示通り<code>source /etc/profile.d/rvm.sh</code>を読み込みます。</p>

<h3>
<span id="centos" class="fragment"></span><a href="#centos"><i class="fa fa-link"></i></a>CentOS</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">rvm.io</span></div>
<div class="highlight"><pre>Installing RVM to /usr/local/rvm/
    Creating group <span class="s1">'rvm'</span>

<span class="c"># RVM:  Shell scripts enabling management of multiple ruby environments.</span>
<span class="c"># RTFM: https://rvm.io/</span>
<span class="c"># HELP: http://webchat.freenode.net/?channels=rvm (#rvm on irc.freenode.net)</span>
<span class="c"># Cheatsheet: http://cheat.errtheblog.com/s/rvm/</span>
<span class="c"># Screencast: http://screencasts.org/episodes/how-to-use-rvm</span>

<span class="c"># In case of any issues read output of 'rvm requirements' and/or 'rvm notes'</span>

Installation of RVM <span class="k">in</span> /usr/local/rvm/ is almost <span class="nb">complete</span>:

  <span class="k">*</span> First you need to add all <span class="nb">users </span>that will be using rvm to <span class="s1">'rvm'</span> group,
    and <span class="nb">logout</span> - login again, anyone using rvm will be operating with <span class="sb">`</span><span class="nb">umask </span><span class="nv">u</span><span class="o">=</span>rwx,g<span class="o">=</span>rwx,o<span class="o">=</span>rx<span class="sb">`</span><span class="nb">.</span>

  <span class="k">*</span> To start using RVM you need to run <span class="sb">`</span><span class="nb">source</span> /etc/profile.d/rvm.sh<span class="sb">`</span>
    <span class="k">in </span>all your open shell windows, <span class="k">in </span>rare cases you need to reopen all shell windows.

<span class="c"># root,</span>
<span class="c">#</span>
<span class="c">#   Thank you for using RVM!</span>
<span class="c">#   I sincerely hope that RVM helps to make your life easier and</span>
<span class="c">#   more enjoyable!!!</span>
<span class="c">#</span>
<span class="c"># ~Wayne</span>
</pre></div>
</div>

<p>こちらも同様にRVMがインストールされました。<br>
インストールが完了したので指示通り<code>source /etc/profile.d/rvm.sh</code>を読み込みます。</p>

<h2>
<span id="rvm-requirement-rubyインストール前にパッケージを整える" class="fragment"></span><a href="#rvm-requirement-ruby%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%89%8D%E3%81%AB%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E6%95%B4%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a><code>rvm requirement</code> Rubyインストール前にパッケージを整える</h2>

<p>先に<code>apt-get udpate</code>や<code>yum update</code>でリモート情報は新しいものにしておきましょう。</p>

<p><code>rvm requirement</code>コマンドでRubyを入れる前にインストールしておいたほうがよいパッケージ群を教えてくれます。</p>

<h3>
<span id="ubuntu-1" class="fragment"></span><a href="#ubuntu-1"><i class="fa fa-link"></i></a>Ubuntu</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">rvm_requirement</span></div>
<div class="highlight"><pre><span class="c"># For ruby:</span>
apt-get <span class="nt">--no-install-recommends</span> <span class="nb">install </span>build-essential openssl libreadline6 libreadline6-dev curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt-dev autoconf libc6-dev libgdbm-dev ncurses-dev automake libtool bison subversion pkg-config libffi-dev
</pre></div>
</div>

<p><code>apt-get</code>のコピペ用文字列がもらえるのでそのままやっときましょう。</p>

<h3>
<span id="cnetos" class="fragment"></span><a href="#cnetos"><i class="fa fa-link"></i></a>CnetOS</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">rvm_requirement</span></div>
<div class="highlight"><pre><span class="c"># For ruby:</span>
yum <span class="nb">install </span>gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel
</pre></div>
</div>

<p>こちらは<code>yum</code>用のコピペ文字列がもらえます、やっときましょう。</p>

<h2>
<span id="rubyインストール" class="fragment"></span><a href="#ruby%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>rubyインストール</h2>

<h3>
<span id="193のインストール" class="fragment"></span><a href="#193%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>1.9.3のインストール</h3>

<p>ここから先は共通です。</p>

<p><code>rvm install 1.9.3</code></p>

<p>rvm側の準備したバイナリがある場合はダウンロード、そうでなければソースからコンパイルされます。<br>
Rubyのstableバージョンならリリース後にしばらくするとバイナリが用意されています。</p>

<p>パッチバージョンを指定する場合は</p>

<p><code>rvm install 1.9.3-p385</code></p>

<h4>
<span id="gems" class="fragment"></span><a href="#gems"><i class="fa fa-link"></i></a>gems</h4>

<p>デフォルトで少しGemsが入っています。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">gem_list</span></div>
<div class="highlight"><pre><span class="c"># gem list</span>

<span class="k">***</span> LOCAL GEMS <span class="k">***</span>

bigdecimal <span class="o">(</span>1.1.0<span class="o">)</span>
bundler <span class="o">(</span>1.2.3<span class="o">)</span>
io-console <span class="o">(</span>0.3<span class="o">)</span>
json <span class="o">(</span>1.5.4<span class="o">)</span>
minitest <span class="o">(</span>2.5.1<span class="o">)</span>
rake <span class="o">(</span>10.0.3, 0.9.2.2<span class="o">)</span>
rdoc <span class="o">(</span>3.9.5<span class="o">)</span>
rubygems-bundler <span class="o">(</span>1.1.0<span class="o">)</span>
rvm <span class="o">(</span>1.11.3.6<span class="o">)</span>
</pre></div>
</div>

<h3>
<span id="デフォルトrubyに指定" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88ruby%E3%81%AB%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>デフォルトRubyに指定</h3>

<p>ログインして使うぶんにはもう十分ですが、他から呼んだりする用にデフォルトで呼ばれるRubyのバージョンを指定します。</p>

<p><code>rvm use 1.9.3 --default</code></p>

<p>指定したバージョンのバイナリが<code>/usr/local/rvm/bin/ruby</code>に設置されます。</p>

<p>以降はPATHに<code>/usr/local/rvm/bin</code>を加えればだいたい何も考えずにRubyが使用出来ます。</p>

<h4>
<span id="デフォルトにしない場合や他のユーザからrvmを使いたい場合" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AB%E3%81%97%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%82%84%E4%BB%96%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%8B%E3%82%89rvm%E3%82%92%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>デフォルトにしない場合や、他のユーザからrvmを使いたい場合</h4>

<p>ユーザが各自でRVMをインストールすることができます。<br>
また、rootでインストールしたrvmを使いまわす場合にはグループ<code>rvm</code>に追加します。</p>

<h2>
<span id="更新など" class="fragment"></span><a href="#%E6%9B%B4%E6%96%B0%E3%81%AA%E3%81%A9"><i class="fa fa-link"></i></a>更新など</h2>

<h3>
<span id="rvm自身の更新" class="fragment"></span><a href="#rvm%E8%87%AA%E8%BA%AB%E3%81%AE%E6%9B%B4%E6%96%B0"><i class="fa fa-link"></i></a>rvm自身の更新</h3>

<p><code>rvm get stable</code><br>
<code>rvm reload</code></p>

<h3>
<span id="rubyの更新" class="fragment"></span><a href="#ruby%E3%81%AE%E6%9B%B4%E6%96%B0"><i class="fa fa-link"></i></a>rubyの更新</h3>

<p>任意のバージョンをインストールして、デフォルトを差し替えます。</p>

<p><code>rvm install 1.9.3</code><br>
<code>rvm use 1.9.3 --default</code></p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>rvmは少々好き嫌いが別れるツールですが、使えるようになっておくとよいです。</p>
